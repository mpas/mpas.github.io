<!DOCTYPE html>
<html lang="en-US">
<head>
  
  <meta charset="utf-8">
  <title>CodeVerse - CodeVerse</title>
  <meta name="description" content="">
  <meta name="author" content="Marco Pas">

  <meta name="generator" content="" />
  <meta name="robots" content="index,follow">

  
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  
  <link rel="stylesheet" href="http://mpas.github.io/css/normalize.css">
  <link rel="stylesheet" href="http://mpas.github.io/css/skeleton.css">
  <link rel="stylesheet" href="http://mpas.github.io/css/custom.css">
  <link rel="stylesheet" href="http://mpas.github.io/css/pygments.css">
  <link rel="stylesheet" href="http://mpas.github.io/css/font-awesome.min.css">

  
  <link rel="icon" type="image/png" href="images/favicon.png">
</head>

<div class="container">
    <div id="header">
        <div class="row">
            <div class="six columns">
                <div id="brand">
                    <a href="http://mpas.github.io">CodeVerse</a>
                </div>
            </div>
            <div class="six columns">
                <nav class="u-pull-right">
                    <ul id="navbar">
                        
                        
                            <li class="current">
                                <a href="/">Blog</a></li>
                        
                            <li >
                                <a href="/post">Post List</a></li>
                        
                            <li >
                                <a href="/page/about/">About</a></li>
                        
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>


<div class="container">
    <div class="row">
        <div class="post-list">
        
        
        
            <article class="post u-cf">
    <div class="row">
        <div class="twelve columns">
            <h1 class="post-title">Change the port of actuator endpoint in a Grails application</h1>
        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <p>When using actuator endpoints to expose metrics in a Grails (Spring Boot) application,
it may be useful to run the metrics on a different port.</p>

<p>This enables you to hide the metrics for the public and use the different port in
an AWS infrastucture so that the metrics are only available internal.</p>

<p>Let us first enable the actuator endpoints</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>// File: grails-app/conf/application.yml

# Spring Actuator Endpoints are Disabled by Default
endpoints:
    enabled: true
    jmx:
        enabled: true
</pre></div>

<p>Change the port on which the metrics runs, add the lines below to the appl</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>// File: grails-app/conf/application.yml

management:
    port: 9000
</pre></div>

<p>Now when you start your Grails application it run on port <code>8080</code> and the metrics
are available on port <code>9090</code>/metrics</p>

        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <div class="post-meta-info">
                Published on
                
                    Tue, Nov 1, 2016
                
                <span class="post-meta-info-taxonomy">
                    in categories:
                        
                    using tags:
                        <a href="/tags/grails">grails</a>, <a href="/tags/springboot">springboot</a>
                </span>
            </div>
        </div>
    </div>
</article>

        
            <article class="post u-cf">
    <div class="row">
        <div class="twelve columns">
            <h1 class="post-title">Accessing localhost from a Docker Container using native Docker for Mac</h1>
        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <p>Ever had a need to access something from within a Docker that runs on the host system?</p>

<p>When using native Docker on OSX you have bad luck. When configuring a container and pointing
that to localhost will result in the fact the your software will be targeted at the localhost
of the docker container.</p>

<p>A solution for this isto define a new local loopback to your localhost</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>$ sudo ifconfig lo0 <span style="color: #f8f8f2">alias</span> 172.16.123.1
</pre></div>

<p>This will define a loopback network interface that points to your localhost.
When you need to access the localhost you can use this ip.</p>

        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <div class="post-meta-info">
                Published on
                
                    Tue, Nov 1, 2016
                
                <span class="post-meta-info-taxonomy">
                    in categories:
                        
                    using tags:
                        <a href="/tags/docker">docker</a>, <a href="/tags/osx">osx</a>, <a href="/tags/mac">mac</a>
                </span>
            </div>
        </div>
    </div>
</article>

        
            <article class="post u-cf">
    <div class="row">
        <div class="twelve columns">
            <h1 class="post-title">Terraform to the rescue</h1>
        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <p>Getting exposed to <a href="https://aws.amazon.com/">Amazon Web Services</a> is fun! Certainly when you see that the infrastructure is growing and supporting the daily need of developers and the business. You slowly start adding services and try to keep everything in a state so that it is repeatable and maintainable. At a certain moment it becomes clear that you need the concept of <a href="https://en.wikipedia.org/wiki/Infrastructure_as_Code">Infrastructure As Code</a>.</p>

<p>The Amazon way of doing this is by using <a href="https://aws.amazon.com/cloudformation/">AWS CloudFormation</a>. This enables you to define the infrastructure in a JSON/YAML format and apply the changes to the infrastructure.</p>

<p>Our team manages a bunch of environments using services like AWS ECS, EC2, ElasticSearch, RDS and more.. Maintaining this infrastructure in CloudFormation seemed the standard way of doing things until we started a proof-of-concept with <a href="https://www.terraform.io/">Terraform</a>.</p>

<p><strong>Why did we start this proof-of-concept??</strong> Mainly because the overwhelming pieces of code that we needed to maintain in CloudFormation became unmaintainable. The use of Terraform was so successful that we decide to rewrite our entire infrastructure codebase using Terraform.</p>

<p>The advantages when using Terraform are:</p>

<ul>
<li>less code to maintain because Terraform is less verbose</li>
<li>when using Terraform an infrastructure change can be planned, this shows what is going to be changed before actually executing the change</li>
</ul>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>$ terraform plan
</pre></div>

<p>See what the changes are and then when everything seems ok&hellip;</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>$ terraform apply
</pre></div>

<p>Currently we have our entire Infrastructure in Terraform and we could never be more happier. Terraform came to our rescue!</p>

        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <div class="post-meta-info">
                Published on
                
                    Sun, Oct 9, 2016
                
                <span class="post-meta-info-taxonomy">
                    in categories:
                        
                    using tags:
                        <a href="/tags/devops">devops</a>, <a href="/tags/aws">aws</a>, <a href="/tags/terraform">terraform</a>
                </span>
            </div>
        </div>
    </div>
</article>

        
            <article class="post u-cf">
    <div class="row">
        <div class="twelve columns">
            <h1 class="post-title">Functional Rest API Testing with Grails/Rest Client Builder</h1>
        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <p>Functional Rest API testing with Grails is easy and fun. We will be creating a simple Rest Controller and test it using Spock and Rest Client Builder.</p>

<p>When running the functional test a real container will be started on a specific port and tests are run against the running container. Just as it should be.</p>

<p><strong>Scenario:</strong><br>
Performing a GET request on a url (<a href="http://localhost:8080/helloworld">http://localhost:8080/helloworld</a>) should return a <code>HTTP Status 200</code> and data with a json payload</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">{</span><span style="color: #f92672">&quot;message&quot;</span><span style="color: #f8f8f2">:</span><span style="color: #e6db74">&quot;helloworld&quot;</span><span style="color: #f8f8f2">}</span>
</pre></div>

<p>So lets get started!</p>

<p><strong>Create a Grails application</strong></p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>$ grails create-app RestHelloWorld
</pre></div>

<p><strong>Update your <code>build.gradle</code> to include the Rest Client Builder dependencies which we will need later on</strong></p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">dependencies</span> <span style="color: #f92672">{</span>
    <span style="color: #75715e">// add the following line to the &#39;dependencies&#39; section</span>
    <span style="color: #f8f8f2">testCompile</span> <span style="color: #e6db74">&quot;org.grails:grails-datastore-rest-client:4.0.7.RELEASE&quot;</span>
<span style="color: #f92672">}</span>
</pre></div>

<p><strong>Create an Integration Test</strong></p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>$ grails create-integration-test HelloWorld
</pre></div>

<p><strong>Create a test method inside the integration test</strong></p>

<p>Open up the created HelloWorldControllerSpec inside the <code>/src/integration-test/groovy/resthelloworld/</code> package</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">package</span> <span style="color: #f8f8f2">resthelloworld</span>

<span style="color: #f92672">import</span> <span style="color: #f8f8f2">grails.test.mixin.integration.Integration</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">grails.transaction.*</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">spock.lang.*</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">grails.plugins.rest.client.RestBuilder</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">grails.plugins.rest.client.RestResponse</span>

<span style="color: #a6e22e">@Integration</span>
<span style="color: #a6e22e">@Rollback</span>
<span style="color: #66d9ef">class</span> <span style="color: #a6e22e">HelloWorldSpec</span> <span style="color: #66d9ef">extends</span> <span style="color: #f8f8f2">Specification</span> <span style="color: #f92672">{</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">setup</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
    <span style="color: #f92672">}</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">cleanup</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
    <span style="color: #f92672">}</span>

    <span style="color: #66d9ef">def</span> <span style="color: #e6db74">&quot;Ask for a nice HelloWorld&quot;</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
        <span style="color: #f8f8f2">given:</span>
        <span style="color: #f8f8f2">RestBuilder</span> <span style="color: #f8f8f2">rest</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">RestBuilder</span><span style="color: #f92672">()</span>

        <span style="color: #f8f8f2">when:</span>
        <span style="color: #f8f8f2">RestResponse</span> <span style="color: #f8f8f2">response</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">rest</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;http://localhost:8080/helloworld/&quot;</span><span style="color: #f92672">)</span>

        <span style="color: #f8f8f2">then:</span>
        <span style="color: #f8f8f2">response</span><span style="color: #f92672">.</span><span style="color: #a6e22e">status</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">200</span>

        <span style="color: #f8f8f2">and:</span>
        <span style="color: #f8f8f2">response</span><span style="color: #f92672">.</span><span style="color: #a6e22e">json</span><span style="color: #f92672">.</span><span style="color: #a6e22e">message</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;helloworld&quot;</span>
    <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
</pre></div>

<p><strong>Run your test</strong></p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>$ grails test-app
</pre></div>

<p>Offcourse this will fail as we do not have implement the controller yet.</p>

<p><strong>Create a Rest controller</strong></p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>$ <span style="color: #f8f8f2">cd</span> RestHelloWorld
$ grails create-controller HelloWorld
</pre></div>

<p><strong>Note:</strong> The generation of the controller also create a Unit Test for the controller, default this test will fail. We are going to delete the generated Unit Test as we do not need it now. This test is located under the <code>/src/test/</code> groovy package.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>$ rm ./src/test/groovy/resthelloworld/HelloWorldControllerSpec.groovy
</pre></div>

<p><strong>Implement the controller function that will return data</strong></p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">package</span> <span style="color: #f8f8f2">resthelloworld</span>

<span style="color: #66d9ef">class</span> <span style="color: #a6e22e">HelloWorldController</span> <span style="color: #f92672">{</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">index</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
        <span style="color: #f8f8f2">render</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">status:</span> <span style="color: #ae81ff">200</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">contentType:</span> <span style="color: #e6db74">&quot;application/json&quot;</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
            <span style="color: #f92672">[</span><span style="color: #e6db74">&quot;message&quot;</span> <span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;helloworld&quot;</span><span style="color: #f92672">]</span>
        <span style="color: #f92672">}</span>
    <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
</pre></div>

<p><strong>Modify UrlMapping</strong></p>

<p>In order to get our newly generated controller accessible via Rest we need to modify our UrlMappings.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">UrlMappings</span> <span style="color: #f92672">{</span>

    <span style="color: #66d9ef">static</span> <span style="color: #f8f8f2">mappings</span> <span style="color: #f92672">=</span> <span style="color: #f92672">{</span>
        <span style="color: #e6db74">&quot;/$controller/$action?/$id?(.$format)?&quot;</span><span style="color: #f92672">{</span>
            <span style="color: #f8f8f2">constraints</span> <span style="color: #f92672">{</span>
                <span style="color: #75715e">// apply constraints here</span>
            <span style="color: #f92672">}</span>
        <span style="color: #f92672">}</span>

        <span style="color: #e6db74">&quot;/&quot;</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">view:</span><span style="color: #e6db74">&quot;/index&quot;</span><span style="color: #f92672">)</span>
        <span style="color: #e6db74">&quot;500&quot;</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">view:</span><span style="color: #e6db74">&#39;/error&#39;</span><span style="color: #f92672">)</span>
        <span style="color: #e6db74">&quot;404&quot;</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">view:</span><span style="color: #e6db74">&#39;/notFound&#39;</span><span style="color: #f92672">)</span>

        <span style="color: #75715e">// add the line below</span>
        <span style="color: #e6db74">&quot;/helloworld/&quot;</span>  <span style="color: #f92672">(</span><span style="color: #f8f8f2">controller:</span> <span style="color: #e6db74">&quot;helloWorld&quot;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">action:</span> <span style="color: #e6db74">&quot;index&quot;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">method:</span> <span style="color: #e6db74">&quot;GET&quot;</span><span style="color: #f92672">)</span>
    <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
</pre></div>

<p><strong>Test your app</strong></p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>$ grails test-app
</pre></div>

<p>You should find that your tests are fine now :)</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>$ grails test-app
BUILD SUCCESSFUL

Total time: 2.054 secs
| Tests PASSED
</pre></div>

        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <div class="post-meta-info">
                Published on
                
                    Thu, Nov 19, 2015
                
                <span class="post-meta-info-taxonomy">
                    in categories:
                        
                    using tags:
                        <a href="/tags/grails">grails</a>, <a href="/tags/spock">spock</a>, <a href="/tags/rest">rest</a>, <a href="/tags/testing">testing</a>
                </span>
            </div>
        </div>
    </div>
</article>

        
            <article class="post u-cf">
    <div class="row">
        <div class="twelve columns">
            <h1 class="post-title">Using DavMail Gateway as a mail proxy for Microsoft Exchange (OWA)</h1>
        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            

<p>If you find yourself into a situation where you have a need for non Microsoft mail client that needs support for Microsoft Exchange then you are often out of luck. In my case I needed Exchange support for the terrific <a href="http://www.postbox-inc.com">PostBox</a> mail client.</p>

<p>As for now PostBox does not support Microsoft Exhange natively so the hunt starts on how to get Exchange working. As it stands most companies also enable Exchange Web Access (or Outlook Web Access [OWA]) so maybe we can use that to feed our native mail client.</p>

<p>Enter the use of <a href="http://davmail.sourceforge.net/">DavMail</a>!</p>

<h4 id="davmail-gateway">Davmail Gateway</h4>

<p>Davmail is a local mail proxy that can work together with Microsoft Exchange [OWA] in a way that DavMail is actually connecting to a Exchange OWA and your mail client connects to DavMail as a proxy.</p>

<p><img src="/images/201511/davmail-sequence.png" width="800" class="postimage"></p>

<h4 id="configure-davmail">Configure Davmail</h4>

<p>In order to get DavMail working correctly you need to provide the correct settings so it can use the OWA endpoint.</p>

<p><img src="/images/201511/davmail-settings-main.png" width="800" class="postimage"></p>

<h4 id="configure-postbox">Configure PostBox</h4>

<p>In order to get PostBox working with DavMail you need to create an outgoing mail server and an account that will use that outgoing mailserver.</p>

<h4 id="configure-postbox-outgoing-mailserver">Configure PostBox - Outgoing mailserver</h4>

<p><img src="/images/201511/postbox-outgoing-mailserver.png" width="400" class="postimage"></p>

<h4 id="configure-postbox-account-setup">Configure PostBox - Account setup</h4>

<p><img src="/images/201511/postbox-account-setup.png" width="800" class="postimage"></p>

<h4 id="configure-postbox-identity-setup">Configure PostBox - Identity setup</h4>

<p><img src="/images/201511/postbox-identity-setup.png" width="800" class="postimage"></p>

<p>Now you are ready to send mail using your PostBox Client using DavMail and OWA.</p>

        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <div class="post-meta-info">
                Published on
                
                    Tue, Nov 17, 2015
                
                <span class="post-meta-info-taxonomy">
                    in categories:
                        
                    using tags:
                        <a href="/tags/davmail">davmail</a>, <a href="/tags/exchange">exchange</a>, <a href="/tags/owa">owa</a>, <a href="/tags/postbox">postbox</a>
                </span>
            </div>
        </div>
    </div>
</article>

        
            <article class="post u-cf">
    <div class="row">
        <div class="twelve columns">
            <h1 class="post-title">Cleaning Grails Domain Objects in a Spock Test</h1>
        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <p>Spock is a nice framework to execute integration tests in your Grails application. It may happen that the Spock test actually creates some domain objects and you want to clean them out on everuy single run of your feature test methods.</p>

<p>Spock provides a <code>setup()</code> and <code>cleanup()</code> method.</p>

<p>When you want to remove your domain objects after each feature test has run you can execute the following:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">def</span> <span style="color: #a6e22e">setup</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span> <span style="color: #f92672">...</span> <span style="color: #f92672">}</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">cleanup</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
        <span style="color: #75715e">// make sure to clear out the database on after test</span>
        <span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">YourDomainObject</span><span style="color: #f92672">&gt;.</span><span style="color: #a6e22e">withNewSession</span> <span style="color: #f92672">{</span>
            <span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">YourDomainObject</span><span style="color: #f92672">&gt;.</span><span style="color: #a6e22e">findAll</span><span style="color: #f92672">().</span><span style="color: #a6e22e">each</span> <span style="color: #f92672">{</span> <span style="color: #f8f8f2">it</span><span style="color: #f92672">.</span><span style="color: #a6e22e">delete</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">flush:</span> <span style="color: #66d9ef">true</span><span style="color: #f92672">)</span> <span style="color: #f92672">}</span>
        <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
</pre></div>

<p>We need the <code>.withNewSession</code> because there is no Hibernate session provided in the <code>setup()</code> and <code>cleanup()</code> methods.</p>

        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <div class="post-meta-info">
                Published on
                
                    Fri, Oct 30, 2015
                
                <span class="post-meta-info-taxonomy">
                    in categories:
                        
                    using tags:
                        <a href="/tags/grails">grails</a>, <a href="/tags/spock">spock</a>
                </span>
            </div>
        </div>
    </div>
</article>

        
            <article class="post u-cf">
    <div class="row">
        <div class="twelve columns">
            <h1 class="post-title">Adding WebSocket/Stomp support to a Spring Boot application</h1>
        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <p>Adding support for <a href="https://en.wikipedia.org/wiki/WebSocket">WebSockets</a> / <a href="https://en.wikipedia.org/wiki/Streaming_Text_Oriented_Messaging_Protocol">Stomp</a> in a <a href="http://projects.spring.io/spring-boot/">Spring Boot</a> application has never been more easy. You can use WebSockets to receive serverside events or push data to the server using WebSockets.</p>

<p>The following example will enable a server to send messages to a WebSocket/Stomp client.</p>

<ul>
<li>Modify <code>build.gradle</code></li>
</ul>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">dependencies</span> <span style="color: #f92672">{</span>
    <span style="color: #f8f8f2">compile</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;org.springframework.boot:spring-boot-starter-web&quot;</span><span style="color: #f92672">)</span>
    <span style="color: #f8f8f2">compile</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;org.springframework.boot:spring-boot-starter-websocket&quot;</span><span style="color: #f92672">)</span>
    <span style="color: #f8f8f2">compile</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;org.springframework:spring-messaging&quot;</span><span style="color: #f92672">)</span>
    <span style="color: #f8f8f2">testCompile</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;junit:junit&quot;</span><span style="color: #f92672">)</span>
<span style="color: #f92672">}</span>
</pre></div>

<ul>
<li>Create a WebSocket configuration class that holds the configuration</li>
</ul>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #a6e22e">@Configuration</span>
<span style="color: #a6e22e">@EnableWebSocketMessageBroker</span>
<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">class</span> <span style="color: #a6e22e">WebSocketConfig</span> <span style="color: #66d9ef">extends</span> <span style="color: #f8f8f2">AbstractWebSocketMessageBrokerConfigurer</span> <span style="color: #f92672">{</span>

    <span style="color: #a6e22e">@Override</span>
    <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">registerStompEndpoints</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">StompEndpointRegistry</span> <span style="color: #f8f8f2">registry</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
        <span style="color: #75715e">// the endpoint for websocket connections</span>
        <span style="color: #f8f8f2">registry</span><span style="color: #f92672">.</span><span style="color: #a6e22e">addEndpoint</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;/stomp&quot;</span><span style="color: #f92672">).</span><span style="color: #a6e22e">withSockJS</span><span style="color: #f92672">();</span>
    <span style="color: #f92672">}</span>

    <span style="color: #a6e22e">@Override</span>
    <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">configureMessageBroker</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">MessageBrokerRegistry</span> <span style="color: #f8f8f2">config</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
        <span style="color: #75715e">// use the /topic prefix for outgoing WebSocket communication</span>
        <span style="color: #f8f8f2">config</span><span style="color: #f92672">.</span><span style="color: #a6e22e">enableSimpleBroker</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;/topic&quot;</span><span style="color: #f92672">);</span>

        <span style="color: #75715e">// use the /app prefix for others</span>
        <span style="color: #f8f8f2">config</span><span style="color: #f92672">.</span><span style="color: #a6e22e">setApplicationDestinationPrefixes</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;/app&quot;</span><span style="color: #f92672">);</span>
    <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
</pre></div>

<p>Now a client that connects to <code>/stomp</code> endpoint is able to receive WebSocket messages.</p>

<ul>
<li>Create a service that is going to send the data to a WebSocket endpoint</li>
</ul>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #a6e22e">@Service</span>
<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">class</span> <span style="color: #a6e22e">ScheduleTask</span> <span style="color: #f92672">{</span>

    <span style="color: #a6e22e">@Autowired</span>
    <span style="color: #66d9ef">private</span> <span style="color: #f8f8f2">SimpMessagingTemplate</span> <span style="color: #f8f8f2">template</span><span style="color: #f92672">;</span>

    <span style="color: #75715e">// this will send a message to an endpoint on which a client can subscribe</span>
    <span style="color: #a6e22e">@Scheduled</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">fixedRate</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">5000</span><span style="color: #f92672">)</span>
    <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">trigger</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
        <span style="color: #75715e">// sends the message to /topic/message</span>
        <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">template</span><span style="color: #f92672">.</span><span style="color: #a6e22e">convertAndSend</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;/topic/message&quot;</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;Date: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Date</span><span style="color: #f92672">());</span>
    <span style="color: #f92672">}</span>

<span style="color: #f92672">}</span>
</pre></div>

<ul>
<li>Create a client that is able to receive the message</li>
</ul>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">&lt;!DOCTYPE html&gt;</span>
<span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">html</span><span style="color: #f8f8f2">&gt;</span>
<span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">head</span><span style="color: #f8f8f2">&gt;</span>
    <span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">title</span><span style="color: #f8f8f2">&gt;</span>WebSocket Stomp Receiving Example<span style="color: #f8f8f2">&lt;/</span><span style="color: #f92672">title</span><span style="color: #f8f8f2">&gt;</span>
<span style="color: #f8f8f2">&lt;/</span><span style="color: #f92672">head</span><span style="color: #f8f8f2">&gt;</span>
<span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">body</span><span style="color: #f8f8f2">&gt;</span>
    <span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">div</span><span style="color: #f8f8f2">&gt;</span>
        <span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">h3</span><span style="color: #f8f8f2">&gt;</span>Messages:<span style="color: #f8f8f2">&lt;/</span><span style="color: #f92672">h3</span><span style="color: #f8f8f2">&gt;</span>
        <span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">ol</span> <span style="color: #a6e22e">id</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;messages&quot;</span><span style="color: #f8f8f2">&gt;&lt;/</span><span style="color: #f92672">ol</span><span style="color: #f8f8f2">&gt;</span>
    <span style="color: #f8f8f2">&lt;/</span><span style="color: #f92672">div</span><span style="color: #f8f8f2">&gt;</span>

    <span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">script</span> <span style="color: #a6e22e">type</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;text/javascript&quot;</span> <span style="color: #a6e22e">src</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;//cdn.jsdelivr.net/jquery/1.11.2/jquery.min.js&quot;</span><span style="color: #f8f8f2">&gt;&lt;/</span><span style="color: #f92672">script</span><span style="color: #f8f8f2">&gt;</span>
    <span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">script</span> <span style="color: #a6e22e">type</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;text/javascript&quot;</span> <span style="color: #a6e22e">src</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;//cdn.jsdelivr.net/sockjs/0.3.4/sockjs.min.js&quot;</span><span style="color: #f8f8f2">&gt;&lt;/</span><span style="color: #f92672">script</span><span style="color: #f8f8f2">&gt;</span>
    <span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">script</span> <span style="color: #a6e22e">type</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;text/javascript&quot;</span> <span style="color: #a6e22e">src</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;//cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js&quot;</span><span style="color: #f8f8f2">&gt;&lt;/</span><span style="color: #f92672">script</span><span style="color: #f8f8f2">&gt;</span>

    <span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">script</span> <span style="color: #a6e22e">type</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;text/javascript&quot;</span><span style="color: #f8f8f2">&gt;</span>
        <span style="color: #a6e22e">$</span><span style="color: #f8f8f2">(document).</span><span style="color: #a6e22e">ready</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">function</span><span style="color: #f8f8f2">()</span> <span style="color: #f8f8f2">{</span>
            <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">messageList</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">$</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;#messages&quot;</span><span style="color: #f8f8f2">);</span>

            <span style="color: #75715e">// defined a connection to a new socket endpoint</span>
            <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">socket</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #a6e22e">SockJS</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/stomp&#39;</span><span style="color: #f8f8f2">);</span>

            <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">stompClient</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">Stomp</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">over</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">socket</span><span style="color: #f8f8f2">);</span>

            <span style="color: #a6e22e">stompClient</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">connect</span><span style="color: #f8f8f2">({</span> <span style="color: #f8f8f2">},</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">frame</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
                <span style="color: #75715e">// subscribe to the /topic/message endpoint</span>
                <span style="color: #a6e22e">stompClient</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">subscribe</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;/topic/message&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">data</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
                    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">message</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">data</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">body</span><span style="color: #f8f8f2">;</span>
                    <span style="color: #a6e22e">messageList</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">append</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;&lt;li&gt;&quot;</span> <span style="color: #f92672">+</span> <span style="color: #a6e22e">message</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;&lt;/li&gt;&quot;</span><span style="color: #f8f8f2">);</span>
                <span style="color: #f8f8f2">});</span>
            <span style="color: #f8f8f2">});</span>
        <span style="color: #f8f8f2">});</span>
    <span style="color: #f8f8f2">&lt;/</span><span style="color: #f92672">script</span><span style="color: #f8f8f2">&gt;</span>
<span style="color: #f8f8f2">&lt;/</span><span style="color: #f92672">body</span><span style="color: #f8f8f2">&gt;</span>
<span style="color: #f8f8f2">&lt;/</span><span style="color: #f92672">html</span><span style="color: #f8f8f2">&gt;</span>
</pre></div>

<p>The whole example project  can be downloaded <a href="https://github.com/mpas/spring-boot-websocket-stomp-server-send-example">https://github.com/mpas/spring-boot-websocket-stomp-server-send-example</a></p>

        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <div class="post-meta-info">
                Published on
                
                    Tue, Jun 16, 2015
                
                <span class="post-meta-info-taxonomy">
                    in categories:
                        
                    using tags:
                        <a href="/tags/spring-boot">spring-boot</a>, <a href="/tags/websocket">websocket</a>
                </span>
            </div>
        </div>
    </div>
</article>

        
            <article class="post u-cf">
    <div class="row">
        <div class="twelve columns">
            <h1 class="post-title">Run a Grails 3 generated Fat Jar file in production mode</h1>
        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <p>When creating a Grails WAR/JAR file using:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>$ grails war
</pre></div>

<p>The resulting artifact can be run in production mode using:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>$ java -Dgrails.env<span style="color: #f92672">=</span>prod -Dserver.port<span style="color: #f92672">=</span><span style="color: #ae81ff">9000</span> -jar &lt;name-of-jar-file&gt;.jar
</pre></div>

        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <div class="post-meta-info">
                Published on
                
                    Thu, Jun 11, 2015
                
                <span class="post-meta-info-taxonomy">
                    in categories:
                        
                    using tags:
                        <a href="/tags/grails">grails</a>
                </span>
            </div>
        </div>
    </div>
</article>

        
            <article class="post u-cf">
    <div class="row">
        <div class="twelve columns">
            <h1 class="post-title">Setting up Docker RabbitMQ with predefined users/vhosts</h1>
        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <p>When creating an Docker image it is nice to have predefined users and vhosts without manually having to create them after the Docker RabbitMQ image has started.</p>

<p>The following is a Dockerfile that extends the default Docker RabbitMQ image including the Management Plugin and it creates a standard set of users / vhosts when the container is created from the image.</p>

<p>It involves a init.sh script that is used to create the users and vhosts.</p>

<p>The Docker File</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">FROM</span><span style="color: #e6db74"> rabbitmq:3-management</span>

<span style="color: #75715e"># Add script to create default users / vhosts</span>
<span style="color: #66d9ef">ADD</span><span style="color: #e6db74"> init.sh /init.sh</span>

<span style="color: #75715e"># Set correct executable permissions</span>
<span style="color: #66d9ef">RUN</span> chmod +x /init.sh

<span style="color: #75715e"># Define default command</span>
<span style="color: #66d9ef">CMD</span><span style="color: #e6db74"> [&quot;/init.sh&quot;]</span>
</pre></div>

<p>The init.sh script</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">#!/bin/sh</span>

<span style="color: #75715e"># Create Default RabbitMQ setup</span>
<span style="color: #f92672">(</span> sleep <span style="color: #ae81ff">10</span> <span style="color: #f8f8f2">;</span> <span style="color: #ae81ff">\</span>

<span style="color: #75715e"># Create users</span>
<span style="color: #75715e"># rabbitmqctl add_user &lt;username&gt; &lt;password&gt;</span>
rabbitmqctl add_user test_user test_user <span style="color: #f8f8f2">;</span> <span style="color: #ae81ff">\</span>

<span style="color: #75715e"># Set user rights</span>
<span style="color: #75715e"># rabbitmqctl set_user_tags &lt;username&gt; &lt;tag&gt;</span>
rabbitmqctl set_user_tags test_user administrator <span style="color: #f8f8f2">;</span> <span style="color: #ae81ff">\</span>

<span style="color: #75715e"># Create vhosts</span>
<span style="color: #75715e"># rabbitmqctl add_vhost &lt;vhostname&gt;</span>
rabbitmqctl add_vhost dummy <span style="color: #f8f8f2">;</span> <span style="color: #ae81ff">\</span>

<span style="color: #75715e"># Set vhost permissions</span>
<span style="color: #75715e"># rabbitmqctl set_permissions -p &lt;vhostname&gt; &lt;username&gt; &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span>
rabbitmqctl set_permissions -p dummy test_user <span style="color: #e6db74">&quot;.*&quot;</span> <span style="color: #e6db74">&quot;.*&quot;</span> <span style="color: #e6db74">&quot;.*&quot;</span> <span style="color: #f8f8f2">;</span> <span style="color: #ae81ff">\</span>
<span style="color: #f92672">)</span> <span style="color: #f8f8f2">&amp;</span>    
rabbitmq-server <span style="color: #f8f8f2">$@</span>
</pre></div>

<p>Place both of these files in a directory and build your image:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>$ docker build -t my_rabbitmq_image .
</pre></div>

<p>Start a container based on the image using:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">$</span> <span style="color: #f8f8f2">docker</span> <span style="color: #f8f8f2">run</span> <span style="color: #f92672">--</span><span style="color: #f8f8f2">rm</span><span style="color: #f92672">=</span><span style="color: #66d9ef">true</span> <span style="color: #f92672">--</span><span style="color: #f8f8f2">name</span> <span style="color: #f8f8f2">my_rabbitmq_container</span> <span style="color: #f92672">-</span><span style="color: #f8f8f2">p</span> <span style="color: #ae81ff">5672</span><span style="color: #f92672">:</span><span style="color: #ae81ff">5672</span> <span style="color: #f92672">-</span><span style="color: #f8f8f2">p</span> <span style="color: #ae81ff">15672</span><span style="color: #f92672">:</span><span style="color: #ae81ff">15672</span>  <span style="color: #f8f8f2">my_rabbitmq_image</span>
</pre></div>

<p>Then in your browser navigate to <a href="http://localhost:15672">http://localhost:15672</a> and see if all is ok!</p>

<p><strong>Note:</strong> When using Boot2Docker make sure to replace the localhost with the correct IP.</p>

        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <div class="post-meta-info">
                Published on
                
                    Thu, Jun 11, 2015
                
                <span class="post-meta-info-taxonomy">
                    in categories:
                        
                    using tags:
                        <a href="/tags/docker">docker</a>, <a href="/tags/rabbitmq">rabbitmq</a>
                </span>
            </div>
        </div>
    </div>
</article>

        
            <article class="post u-cf">
    <div class="row">
        <div class="twelve columns">
            <h1 class="post-title">HTTPServletRequestWrapper for ServletInputStream 3.1</h1>
        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <p>A HttpServletRequestWrapper may be handy if you want to be able to read the HTTP Body multi times after you consume it in a filter. The ServletInputStream 3.1 changed a bit and the following methods have to be implemented.</p>

<ul>
<li>isFinished</li>
<li>isReady</li>
<li>setReadListener</li>
</ul>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">import</span> <span style="color: #f8f8f2">com.google.common.primitives.Bytes</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">javax.servlet.ReadListener</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">javax.servlet.ServletInputStream</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">javax.servlet.http.HttpServletRequest</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">javax.servlet.http.HttpServletRequestWrapper</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.io.ByteArrayInputStream</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.io.IOException</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.io.InputStream</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.util.Arrays</span><span style="color: #f92672">;</span>

<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">class</span> <span style="color: #a6e22e">AuthenticationRequestWrapper</span> <span style="color: #66d9ef">extends</span> <span style="color: #f8f8f2">HttpServletRequestWrapper</span> <span style="color: #f92672">{</span>

    <span style="color: #75715e">// tag::variables[]</span>
    <span style="color: #66d9ef">private</span> <span style="color: #66d9ef">byte</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">requestBody</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #66d9ef">byte</span><span style="color: #f92672">[</span><span style="color: #ae81ff">0</span><span style="color: #f92672">];</span>
    <span style="color: #66d9ef">private</span> <span style="color: #66d9ef">boolean</span> <span style="color: #f8f8f2">bufferFilled</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">false</span><span style="color: #f92672">;</span>
    <span style="color: #75715e">// end::variables[]</span>

    <span style="color: #75715e">/**</span>
<span style="color: #75715e">     - Constructs a request object wrapping the given request.</span>
<span style="color: #75715e">     *</span>
<span style="color: #75715e">     - @param request The request to wrap</span>
<span style="color: #75715e">     - @throws IllegalArgumentException if the request is null</span>
<span style="color: #75715e">     */</span>
    <span style="color: #66d9ef">public</span> <span style="color: #a6e22e">AuthenticationRequestWrapper</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">HttpServletRequest</span> <span style="color: #f8f8f2">request</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
        <span style="color: #66d9ef">super</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">request</span><span style="color: #f92672">);</span>
    <span style="color: #f92672">}</span>


    <span style="color: #75715e">// tag::getRequestBody[]</span>
    <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">byte</span><span style="color: #f92672">[]</span> <span style="color: #a6e22e">getRequestBody</span><span style="color: #f92672">()</span> <span style="color: #66d9ef">throws</span> <span style="color: #f8f8f2">IOException</span> <span style="color: #f92672">{</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">bufferFilled</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
            <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">Arrays</span><span style="color: #f92672">.</span><span style="color: #a6e22e">copyOf</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">requestBody</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">requestBody</span><span style="color: #f92672">.</span><span style="color: #a6e22e">length</span><span style="color: #f92672">);</span>
        <span style="color: #f92672">}</span>

        <span style="color: #f8f8f2">InputStream</span> <span style="color: #f8f8f2">inputStream</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">super</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getInputStream</span><span style="color: #f92672">();</span>

        <span style="color: #66d9ef">byte</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">buffer</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #66d9ef">byte</span><span style="color: #f92672">[</span><span style="color: #ae81ff">102400</span><span style="color: #f92672">];</span> <span style="color: #75715e">// 100kb buffer</span>

        <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">bytesRead</span><span style="color: #f92672">;</span>
        <span style="color: #66d9ef">while</span> <span style="color: #f92672">((</span><span style="color: #f8f8f2">bytesRead</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">inputStream</span><span style="color: #f92672">.</span><span style="color: #a6e22e">read</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">buffer</span><span style="color: #f92672">))</span> <span style="color: #f92672">!=</span> <span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
            <span style="color: #f8f8f2">requestBody</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Bytes</span><span style="color: #f92672">.</span><span style="color: #a6e22e">concat</span><span style="color: #f92672">(</span><span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">requestBody</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Arrays</span><span style="color: #f92672">.</span><span style="color: #a6e22e">copyOfRange</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">buffer</span><span style="color: #f92672">,</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">bytesRead</span><span style="color: #f92672">));</span> <span style="color: #75715e">// &lt;1&gt;</span>
        <span style="color: #f92672">}</span>

        <span style="color: #f8f8f2">bufferFilled</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">true</span><span style="color: #f92672">;</span>

        <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">requestBody</span><span style="color: #f92672">;</span>
    <span style="color: #f92672">}</span>
    <span style="color: #75715e">// end::getRequestBody[]</span>

    <span style="color: #75715e">// tag::getInputStream[]</span>
    <span style="color: #a6e22e">@Override</span>
    <span style="color: #66d9ef">public</span> <span style="color: #f8f8f2">ServletInputStream</span> <span style="color: #a6e22e">getInputStream</span><span style="color: #f92672">()</span> <span style="color: #66d9ef">throws</span> <span style="color: #f8f8f2">IOException</span> <span style="color: #f92672">{</span>
        <span style="color: #66d9ef">return</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">CustomServletInputStream</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">getRequestBody</span><span style="color: #f92672">());</span> <span style="color: #75715e">// &lt;1&gt;</span>
    <span style="color: #f92672">}</span>
    <span style="color: #75715e">// end::getInputStream[]</span>

    <span style="color: #66d9ef">private</span> <span style="color: #66d9ef">static</span> <span style="color: #66d9ef">class</span> <span style="color: #a6e22e">CustomServletInputStream</span> <span style="color: #66d9ef">extends</span> <span style="color: #f8f8f2">ServletInputStream</span> <span style="color: #f92672">{</span>

        <span style="color: #66d9ef">private</span> <span style="color: #f8f8f2">ByteArrayInputStream</span> <span style="color: #f8f8f2">buffer</span><span style="color: #f92672">;</span>

        <span style="color: #66d9ef">public</span> <span style="color: #a6e22e">CustomServletInputStream</span><span style="color: #f92672">(</span><span style="color: #66d9ef">byte</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">contents</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
            <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">buffer</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">ByteArrayInputStream</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">contents</span><span style="color: #f92672">);</span>
        <span style="color: #f92672">}</span>

        <span style="color: #a6e22e">@Override</span>
        <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">int</span> <span style="color: #a6e22e">read</span><span style="color: #f92672">()</span> <span style="color: #66d9ef">throws</span> <span style="color: #f8f8f2">IOException</span> <span style="color: #f92672">{</span>
            <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">buffer</span><span style="color: #f92672">.</span><span style="color: #a6e22e">read</span><span style="color: #f92672">();</span>
        <span style="color: #f92672">}</span>

        <span style="color: #a6e22e">@Override</span>
        <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">boolean</span> <span style="color: #a6e22e">isFinished</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
            <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">buffer</span><span style="color: #f92672">.</span><span style="color: #a6e22e">available</span><span style="color: #f92672">()</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span>
        <span style="color: #f92672">}</span>

        <span style="color: #a6e22e">@Override</span>
        <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">boolean</span> <span style="color: #a6e22e">isReady</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
            <span style="color: #66d9ef">return</span> <span style="color: #66d9ef">true</span><span style="color: #f92672">;</span>
        <span style="color: #f92672">}</span>

        <span style="color: #a6e22e">@Override</span>
        <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">setReadListener</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">ReadListener</span> <span style="color: #f8f8f2">listener</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
            <span style="color: #66d9ef">throw</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">RuntimeException</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Not implemented&quot;</span><span style="color: #f92672">);</span>
        <span style="color: #f92672">}</span>
    <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
</pre></div>

        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <div class="post-meta-info">
                Published on
                
                    Wed, Jun 10, 2015
                
                <span class="post-meta-info-taxonomy">
                    in categories:
                        
                    using tags:
                        <a href="/tags/java">java</a>
                </span>
            </div>
        </div>
    </div>
</article>

        
        </div>
    </div>
</div>


<div class="container">
    <div class="row">
        <div class="twelve columns">
        
            <ul class="pager">
            
            
                <li>
                <a class="button" href="/page/2">Older Posts &rarr;</a>
                </li>
            
            </ul>
        
        </div>
    </div>
</div>

<footer>
    <div class="container">
        <div class="row">
            <div class="twelve columns">
                <div id="social">
                    
                        <a title="Twitter" href="https://twitter.com/marcopas">
                            <i class="fa fa-twitter"></i>
                        </a>
                    
                    
                        <a title="LinkedIn" href="https://www.linkedin.com/in/marcopas">
                            <i class="fa fa-linkedin"></i>
                        </a>
                    
                    
                        <a title="GitHub" href="https://github.com/mpas">
                            <i class="fa fa-github"></i>
                        </a>
                    
                    
                        <a title="StackOverflow" href="http://stackoverflow.com/users/185432/marco">
                            <i class="fa fa-stack-overflow"></i>
                        </a>
                    
                    
                        <a title="Flickr" href="https://www.flickr.com/photos/marcopas/">
                            <i class="fa fa-flickr"></i>
                        </a>
                    
                    
                        <a title="Facebook" href="https://www.facebook.com/marco.pasopas">
                            <i class="fa fa-facebook"></i>
                        </a>
                    
                    
                        <a title="Email" href="mailto:marco.pasopas@gmail.com">
                            <i class="fa fa-envelope-o"></i>
                        </a>
                    
            </div>
        </div>

        <div class="row">
            <div class="twelve columns" id="copyright">&copy; 2016 ~ CodeVerse / Powered by <a href="http://gohugo.io/">Hugo</div>
        </div>
    </div>
</footer>
</body>
</html>

