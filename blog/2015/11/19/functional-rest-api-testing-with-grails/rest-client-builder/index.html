<!DOCTYPE html>
<html class="no-js" lang="en-us" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="description" content="Functional Rest API Testing with Grails/Rest Client Builder">
    <meta name="author" content="Marco Pas">

    <meta name="keyword" content="">
    <link rel="shortcut icon" href="/favicon.ico">

    <title>Functional Rest API Testing with Grails/Rest Client Builder &middot; CodeVerse</title>

   	
    
        <link rel="stylesheet" href="http://mpas.github.io/css/theme/cerulean.css">
    

    <link rel="stylesheet" href="http://mpas.github.io/css/font-awesome.min.css">

   	
   	<link rel="stylesheet" href="http://mpas.github.io/css/style.css">


    
    <script src="http://mpas.github.io/js/jquery.min-2.1.4.js"></script>
    <script src="http://mpas.github.io/js/bootstrap.min-3.3.5.js"></script>

    
    <link href="" rel="alternate" type="application/rss+xml" title="CodeVerse" />
</head>
<body lang="en">
    
    <div class="container">
    <div class="row">
        <div class="navbar navbar-default navbar-inverse" role="navigation">
            <div class="navbar-header">
                <a class="navbar-brand" href="http://mpas.github.io">CodeVerse</a>
            </div>
            <div class="navbar-collapse collapse navbar-responsive-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="http://mpas.github.io">Home</a></li>
                    <li><a href="http://mpas.github.io/post/">Blog</a></li>
                    
                      <li><a href="/blog/2015/10/30/about/"> About </a></li>
                    
                </ul>
            </div>
        </div>
    </div>
</div>



<div class="container">
	<div class="row">
		<div class="col-md-offset-1 col-md-10">
			<h3>Functional Rest API Testing with Grails/Rest Client Builder</h3>
				<span class="label label-primary">19.11.2015</span> in 
				
					
					<a href="/categories/development">Development</a>
				 using tags
				
					
					<a href="/tags/grails">grails</a>
				
					 , 
					<a href="/tags/spock">spock</a>
				
					 , 
					<a href="/tags/rest">rest</a>
				
					 , 
					<a href="/tags/testing">testing</a>
				
			</small>
		</div>
	</div>
	<div class="row">
		<div class="col-md-offset-1 col-md-10">
			<br>
			<p>Functional Rest API testing with Grails is easy and fun. We will be creating a simple Rest Controller and test it using Spock and Rest Client Builder.</p>

<p>When running the functional test a real container will be started on a specific port and tests are run against the running container. Just as it should be.</p>

<p><strong>Scenario:</strong><br>
Performing a GET request on a url (<a href="http://localhost:8080/helloworld">http://localhost:8080/helloworld</a>) should return a <code>HTTP Status 200</code> and data with a json payload <code>{&quot;message&quot;:&quot;helloworld&quot;}</code></p>

<p>So lets get started!</p>

<p><strong>Create a Grails application</strong></p>

<pre><code>$ grails create-app RestHelloWorld
</code></pre>

<p><strong>Update your <code>build.gradle</code> to include the Rest Client Builder dependencies which we will need later on</strong></p>

<pre><code>dependencies {
    // add the following line to the 'dependencies' section
    testCompile &quot;org.grails:grails-datastore-rest-client:4.0.7.RELEASE&quot;
}
</code></pre>

<p><strong>Create an Integration Test</strong></p>

<pre><code>$ grails create-integration-test HelloWorld
</code></pre>

<p><strong>Create a test method inside the integration test</strong></p>

<p>Open up the created HelloWorldControllerSpec inside the <code>/src/integration-test/groovy/resthelloworld/</code> package</p>

<pre><code>package resthelloworld

import grails.test.mixin.integration.Integration
import grails.transaction.*
import spock.lang.*
import grails.plugins.rest.client.RestBuilder
import grails.plugins.rest.client.RestResponse

@Integration
@Rollback
class HelloWorldSpec extends Specification {

    def setup() { 
    }

    def cleanup() { 
    }

    def &quot;Ask for a nice HelloWorld&quot;() {
        given:
        RestBuilder rest = new RestBuilder()

        when:
        RestResponse response = rest.get(&quot;http://localhost:8080/helloworld/&quot;)

        then:
        response.status == 200

        and:
        response.json.message == &quot;helloworld&quot;
    }
}
</code></pre>

<p><strong>Run your test</strong></p>

<pre><code>$ grails test-app
</code></pre>

<p>Offcourse this will fail as we do not have implement the controller yet.</p>

<p><strong>Create a Rest controller</strong></p>

<pre><code>$ cd RestHelloWorld
$ grails create-controller HelloWorld
</code></pre>

<p><strong>Note:</strong> The generation of the controller also create a Unit Test for the controller, default this test will fail. We are going to delete the generated Unit Test as we do not need it now. This test is located under the <code>/src/test/</code> groovy package.</p>

<pre><code>    $ rm ./src/test/groovy/resthelloworld/HelloWorldControllerSpec.groovy
</code></pre>

<p><strong>Implement the controller function that will return data</strong></p>

<pre><code>package resthelloworld

class HelloWorldController {

    def index() {
        render(status: 200, contentType: &quot;application/json&quot;) {
            [&quot;message&quot; : &quot;helloworld&quot;]
        }
    }
}
</code></pre>

<p><strong>Modify UrlMapping</strong>
In order to get our newly generated controller accesible via Rest we need to modify our UrlMappings.</p>

<pre><code>class UrlMappings {

    static mappings = {
        &quot;/$controller/$action?/$id?(.$format)?&quot;{
            constraints {
                // apply constraints here
            }
        }

        &quot;/&quot;(view:&quot;/index&quot;)
        &quot;500&quot;(view:'/error')
        &quot;404&quot;(view:'/notFound')

        // add the line below
        &quot;/helloworld/&quot;  (controller: &quot;helloWorld&quot;, action: &quot;index&quot;, method: &quot;GET&quot;)
    }
}
</code></pre>

<p><strong>Test your app</strong></p>

<pre><code>$ grails test-app
</code></pre>

<p>You should find that your tests are fine now :)</p>

<pre><code>$ grails test-app
BUILD SUCCESSFUL

Total time: 2.054 secs
| Tests PASSED
</code></pre>

		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<hr>
		</div>
	</div>
</div>

    <div class="container">
        <div class="row col-md-12">
            <footer>
                <div class="pull-left">
                    <p>
                        &copy; 2015 ~ Marco Pas ~ Powered By <a href="http://hugo.spf13.com">Hugo</a> - version: 0.14 ~ <a href="http://mpas.github.io/license">License</a>
                    </p>
                </div>

                
                <div class="pull-right">
                    
                        <a href="" target="_blank">
                        <i class="fa fa-linkedin fa-2x"></i></a>
                    
                    
                        <a href="https://www.facebook.com/marco.pasopas" target="_blank">
                        <i class="fa fa-facebook-square fa-2x"></i></a>
                    
                    
                        <a href="https://twitter.com/marcopas" target="_blank">
                        <i class="fa fa-twitter-square fa-2x"></i></a>
                    
                    
                        <a href="https://github.com/mpas" target="_blank">
                        <i class="fa fa-github-square fa-2x"></i></a>
                    
                    
                        <a href="https://delicious.com/marcopas" target="_blank">
                        <i class="fa fa-delicious fa-2x"></i></a>
                    
                    
                        <a href="https://www.flickr.com/photos/marcopas/" target="_blank">
                        <i class="fa fa-flickr fa-2x"></i></a>
                    
                        <a href="" target="_blank">
                        <i class="fa fa-rss-square fa-2x"></i></a>
                </div>
            </footer>
        </div>
    </div>

    
    </body>
</html>

