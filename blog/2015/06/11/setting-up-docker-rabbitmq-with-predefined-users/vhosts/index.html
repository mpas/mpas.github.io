<!DOCTYPE html>
<html class="no-js" lang="en-US" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="description" content="Setting up Docker RabbitMQ with predefined users/vhosts">
    <meta name="author" content="Marco Pas">

    <meta name="keyword" content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>Setting up Docker RabbitMQ with predefined users/vhosts</title>

   	
    
        <link rel="stylesheet" href="http://mpas.github.io//css/theme/journal.css">
    

    <link rel="stylesheet" href="http://mpas.github.io//css/font-awesome.min.css">

   	
   	<link rel="stylesheet" href="http://mpas.github.io//css/style.css">


    
    <script src="http://mpas.github.io//js/jquery.min-2.1.4.js"></script>
    <script src="http://mpas.github.io//js/bootstrap.min-3.3.5.js"></script>

    
    <link href="" rel="alternate" type="application/rss+xml" title="CodeVerse" />
</head>
<body lang="en">
    
    <div class="container">
    <div class="row">
        <div class="navbar navbar-default navbar-inverse" role="navigation">
            <div class="navbar-header">
                <a class="navbar-brand" href="http://mpas.github.io/">CodeVerse</a>
            </div>
            <div class="navbar-collapse collapse navbar-responsive-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="http://mpas.github.io/">Home</a></li>
                    <li><a href="http://mpas.github.io//page/about/">About</a></li>
                    <li><a href="http://mpas.github.io//page/resume/">Resume</a></li>
                    <li><a href="http://mpas.github.io//post/">Blog</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>



<div class="container">	
	<div class="row">
		<div class="col-md-offset-1 col-md-10">
			<h3>Setting up Docker RabbitMQ with predefined users/vhosts</h3>
				<span class="label label-primary">Thu Jun 11, 2015</span> in 
				
					
					<a href="/categories/development">Development</a>
				
					 , 
					<a href="/categories/devops">DevOps</a>
				 using tags 			 
				
					
					<a href="/tags/docker">docker</a>
				
					 , 
					<a href="/tags/rabbitmq">rabbitmq</a>
				
			</small>
		</div>
	</div>
	<div class="row">
		<div class="col-md-offset-1 col-md-10">
			<br>
			<p>When creating an Docker image it is nice to have predefined users and vhosts without manually having to create them after the Docker RabbitMQ image has started.</p>

<p>The following is a Dockerfile that extends the default Docker RabbitMQ image including the Management Plugin and it creates a standard set of users / vhosts when the container is created from the image.</p>

<p>It involves a init.sh script that is used to create the users and vhosts.</p>

<p>The Docker File</p>

<pre><code>FROM rabbitmq:3-management

# Add script to create default users / vhosts
ADD init.sh /init.sh

# Set correct executable permissions
RUN chmod +x /init.sh

# Define default command
CMD [&quot;/init.sh&quot;]
</code></pre>

<p>The init.sh script</p>

<pre><code>#!/bin/sh

# Create Default RabbitMQ setup
( sleep 10 ; \

# Create users
# rabbitmqctl add_user &lt;username&gt; &lt;password&gt;
rabbitmqctl add_user test_user test_user ; \

# Set user rights
# rabbitmqctl set_user_tags &lt;username&gt; &lt;tag&gt;
rabbitmqctl set_user_tags test_user administrator ; \

# Create vhosts
# rabbitmqctl add_vhost &lt;vhostname&gt;
rabbitmqctl add_vhost dummy ; \

# Set vhost permissions
# rabbitmqctl set_permissions -p &lt;vhostname&gt; &lt;username&gt; &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;
rabbitmqctl set_permissions -p dummy test_user &quot;.*&quot; &quot;.*&quot; &quot;.*&quot; ; \
) &amp;    
rabbitmq-server $@
</code></pre>

<p>Place both of these files in a directory and build your image:</p>

<pre><code>$ docker build -t my_rabbitmq_image .
</code></pre>

<p>Start a container based on the image using:</p>

<pre><code>$ docker run --rm=true --name my_rabbitmq_container -p 5672:5672 -p 15672:15672  my_rabbitmq_image
</code></pre>

<p>Then in your browser navigate to <a href="http://localhost:15672">http://localhost:15672</a> and see if all is ok!</p>

<p><strong>Note:</strong> When using Boot2Docker make sure to replace the localhost with the correct IP.</p>

		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<hr>
		</div>
	</div>	
</div>

    <div class="container">
        <div class="row col-md-12">
            <footer>
                <div class="pull-left">
                    <p>
                        &copy; 2014 Marco Pas ~ Powered By <a href="http://hugo.spf13.com">Hugo</a> - version: 0.14 ~ Copyright Â© 2015 <a href="http://mpas.github.io//license">License</a>
                    </p>
                </div>

                
                <div class="pull-right">
                    
                        <a href="https://www.facebook.com/marco.pasopas" target="_blank">
                        <i class="fa fa-facebook-square fa-2x"></i></a>
                    
                    
                        <a href="https://twitter.com/marcopas" target="_blank">
                        <i class="fa fa-twitter-square fa-2x"></i></a>
                    
                    
                        <a href="https://github.com/mpas" target="_blank">
                        <i class="fa fa-github-square fa-2x"></i></a>
                    
                    
                        <a href="https://delicious.com/marcopas" target="_blank">
                        <i class="fa fa-delicious fa-2x"></i></a>
                    
                        <a href="" target="_blank">
                        <i class="fa fa-rss-square fa-2x"></i></a>
                </div>
            </footer>
        </div>
    </div>

    
    </body>
</html>
